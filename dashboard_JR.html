<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BZ55 Â· Dashboard Centro</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script>
/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *  BZ55 FITNESS CONCEPT Â· CONFIGURACIÃ“N CENTRAL
 *  Este archivo se define UNA SOLA VEZ y no se toca mÃ¡s
 *  salvo que cambien las reglas de negocio o se aÃ±ada un centro
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

const BZ55_CONFIG = {

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  //  CENTROS DE LA RED
  //  AÃ±ade un nuevo objeto aquÃ­ cuando se incorpore un centro
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  centros: [
    {
      id: 'JR',
      nombre: 'JuliÃ¡n Romea',
      ciudad: 'Madrid',
      color: '#6c63ff',
      objetivo_clientes: 150,
      estado: 'estable',           // 'estable' | 'rescate' | 'nuevo'
      apertura: 'Octubre 2024',
      destinatarios: {
        email: 'mdemiguel@bz-55.com, Rwirz@bz-55.com, miguel.lozano.garrido@gmail.com',
        whatsapp: '+34683460933',
      },
    },
    {
      id: 'LDH',
      nombre: 'LÃ³pez de Hoyos',
      ciudad: 'Madrid',
      color: '#f5c842',
      objetivo_clientes: 150,
      estado: 'rescate',
      apertura: 'Noviembre 2025',
      destinatarios: {
        email: 'mfernandez@gaiagd.com, apastoriza@transgalaica.com, josemanuelamadoabelenda@gmail.com, miguel.lozano.garrido@gmail.com',
        whatsapp: '+34683460933',
      },
    },
    // Descomenta y rellena cuando se aÃ±ada el prÃ³ximo centro:
    // {
    //   id: 'C3',
    //   nombre: 'Nombre Centro',
    //   ciudad: 'Ciudad',
    //   color: '#00e8a2',
    //   objetivo_clientes: 150,
    //   estado: 'nuevo',
    //   apertura: 'Mes AÃ±o',
    //   destinatarios: { email: '', whatsapp: '' },
    // },
  ],

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  //  COLUMNAS DEL EXCEL
  //  Si el ERP cambia algÃºn nombre de columna, solo toca aquÃ­
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  columnas: {
    cliente_id:     'Cliente (ID)',
    servicio:       'Elemento2',
    importe:        'Total sin IVA',
    anyo:           'AÃ±o',
    mes:            'Mes',
    factura_fecha:  'Factura',
    centro_id:      null,   // Si el Excel lleva columna de centro, ponla aquÃ­
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  //  SERVICIOS VÃLIDOS PARA CLIENTES ACTIVOS Y CUOTA MEDIA
  //  TambiÃ©n son la base para calcular altas y bajas
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  servicios_validos: new Set([
    '1 SESIÃ“N SEMANA - S.GENERAL',
    '1 SESIÃ“N SEMANA FOUNDERS',
    '2 SESIONES SEMANA - S.GENERAL',
    '2 SESIONES SEMANA FOUNDERS',
    '3 SESIONES SEMANA - S.GENERAL',
    '3 SESIONES SEMANA FOUNDERS',
    'BONO 4 SESIONES - S.GENERAL',
    'BONO 4 SESIONES FOUNDERS',
    'BONO 8 SESIONES FOUNDERS',
    'SESIÃ“N INDIVIDUAL 1:1',
    '1 SESIÃ“N SEMANAL / MES',
    '1 SESIÃ“N SEMANAL / MES ANIVERSARIO',
    '1 SESIÃ“N SEMANAL / MES FOUNDERS',
    '2 SESIONES SEMANALES / MES',
    '2 SESIONES SEMANALES / MES ANIVERSARIO',
    '2 SESIONES SEMANALES / MES FOUNDERS',
    '3 SESIONES SEMANALES / MES',
    '3 SESIONES SEMANALES / MES ANIVERSARIO',
    '3 SESIONES SEMANALES / MES FOUNDERS',
    'BONO 2 SESIONES',
    'BONO 4 SESIONES',
    'BONO 4 SESIONES / MES',
    'BONO 4 SESIONES / MES ANIVERSARIO',
    'BONO 4 SESIONES / MES FOUNDERS',
    'BONO 8 SESIONES',
    'BONO 8 SESIONES / MES',
    'BONO 8 SESIONES / MES ANIVERSARIO',
    'BONO 8 SESIONES / MES FOUNDERS',
    'E.P. 2:1 BONO 12 SESIONES (CADUCIDAD: 2 MESES)',
    'E.P. 2:1 BONO 4 SESIONES (CADUCIDAD: 1 MES)',
    'E.P. 2:1 BONO 8 SESIONES (CADUCIDAD: 2 MESES)',
    'EVERY DAY / (1 DIARIA)',
    'EVERY DAY / (1 DIARIA) ANIVERSARIO',
    'EVERY DAY / (1 DIARIA) FOUNDERS',
    'TARIFA ANIVERSARIO',
    'TARIFAS FOUNDERS',
  ]),

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  //  SESIONES DE PRUEBA
  //  Cuentan para ratio de cierre pero NO como clientes activos
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  servicios_prueba: new Set([
    'SESIÃ“N DE PRUEBA',
    '1 SESIÃ“N DE PRUEBA',
  ]),

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  //  SERVICIOS EXCLUIDOS DE CLIENTES
  //  Solo cuentan para facturaciÃ³n total
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  servicios_excluidos: new Set([
    'CALCETINES ANTIDESLIZANTES 36-41',
    'CALCETINES ANTIDESLIZANTES BZ55 GRISES',
    'SESIÃ“N INDIVIDUAL GRUPO',
    '1 SESIÃ“N INDIVIDUAL EN GRUPO',
    'ALQUILER TOALLA DUCHA',
    'BOTELLA ALUMINIO AZUL',
    'BOTELLA ALUMINIO FUCSIA',
    'BOTELLA ALUMINIO PLATA',
    'CAJA REGALO',
    'CALCETINES ANTIDESLIZANTES 41-46',
    'CALCETINES ANTIDESLIZANTES BZ55 - BLANCO',
    'CALCETINES ANTIDESLIZANTES BZ55 - GRIS',
    'GRUPOS REDUCIDOS',
    'SESIÃ“N PAREJA ENTRENO PERSONAL',
    'SUMMER PACK',
    'TOTE BAG',
  ]),

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  //  NOMBRES DE MESES EN ESPAÃ‘OL
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  meses: ['','Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'],
};

</script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Unbounded:wght@300;400;600;800&family=Epilogue:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap');

:root {
  --bg:       #07070f;
  --bg2:      #0d0d1a;
  --card:     #10101e;
  --border:   #1c1c32;
  --border2:  #28284a;
  --accent:   #6c63ff;
  --green:    #00e8a2;
  --gold:     #f5c842;
  --red:      #ff4f6e;
  --blue:     #3db8ff;
  --text:     #eeeef5;
  --muted:    #5a5a80;
  --muted2:   #3a3a58;
  --c:        #6c63ff;  /* overridden per center */
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Epilogue', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background-image:
    linear-gradient(rgba(108,99,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(108,99,255,0.03) 1px, transparent 1px);
  background-size: 48px 48px;
  pointer-events: none; z-index: 0;
}

/* â”€â”€ Header â”€â”€ */
header {
  position: sticky; top: 0; z-index: 100;
  background: rgba(7,7,15,0.94);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  padding: 0 40px; height: 64px;
  display: flex; align-items: center; justify-content: space-between;
}
.logo { font-family: 'Unbounded', sans-serif; font-weight: 800; font-size: 1.25rem; letter-spacing: -0.02em; }
.logo span { color: var(--c); }
.header-center-name { font-family: 'Unbounded', sans-serif; font-size: 0.75rem; font-weight: 600; color: var(--c); letter-spacing: -0.01em; }
.header-right { display: flex; align-items: center; gap: 16px; }
.update-pill {
  font-family: 'JetBrains Mono', monospace; font-size: 0.58rem; letter-spacing: 0.12em;
  padding: 5px 12px; border: 1px solid var(--border2); color: var(--muted);
  text-transform: uppercase;
}
.share-btn {
  padding: 8px 16px; background: var(--c); color: white; border: none; cursor: pointer;
  font-family: 'Epilogue', sans-serif; font-size: 0.75rem; font-weight: 600;
  display: flex; align-items: center; gap: 6px; transition: opacity 0.15s;
}
.share-btn:hover { opacity: 0.85; }

/* â”€â”€ No data state â”€â”€ */
.no-data {
  position: relative; z-index: 1;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  min-height: 60vh; gap: 16px; text-align: center; padding: 40px;
}
.no-data-icon { font-size: 3rem; }
.no-data h2 { font-family: 'Unbounded', sans-serif; font-size: 1.4rem; font-weight: 600; }
.no-data p { font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--muted); letter-spacing: 0.1em; line-height: 1.8; }
.no-data a { color: var(--accent); }

/* â”€â”€ Main â”€â”€ */
main { position: relative; z-index: 1; padding: 36px 40px 60px; max-width: 1400px; margin: 0 auto; }

/* â”€â”€ Alert banner (rescue) â”€â”€ */
.alert-banner {
  background: rgba(255,79,110,0.08); border: 1px solid rgba(255,79,110,0.3);
  padding: 14px 20px; margin-bottom: 28px;
  display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
}
.alert-icon { font-size: 1.1rem; }
.alert-text { font-family: 'Epilogue', sans-serif; font-size: 0.85rem; font-weight: 600; flex: 1; }
.alert-sub { font-family: 'JetBrains Mono', monospace; font-size: 0.62rem; color: var(--muted); }

/* â”€â”€ Section label â”€â”€ */
.section-label {
  font-family: 'JetBrains Mono', monospace; font-size: 0.6rem;
  letter-spacing: 0.25em; text-transform: uppercase; color: var(--muted);
  margin-bottom: 16px; padding-bottom: 10px; border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
}
.section-label::before { content: ''; display: block; width: 16px; height: 1px; background: var(--c); }

/* â”€â”€ KPI Grid â”€â”€ */
.kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
.kpi-grid-8 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
.kpi-card {
  background: var(--card); border: 1px solid var(--border);
  padding: 22px 20px; position: relative; overflow: hidden;
}
.kpi-card::after {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: var(--kpi-c, var(--c));
}
.kpi-label { font-family: 'JetBrains Mono', monospace; font-size: 0.56rem; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); margin-bottom: 12px; }
.kpi-val { font-family: 'Unbounded', sans-serif; font-size: 2.1rem; font-weight: 600; line-height: 1; letter-spacing: -0.03em; }
.kpi-val .u { font-size: 1rem; font-weight: 300; color: var(--muted); }
.kpi-delta { font-family: 'JetBrains Mono', monospace; font-size: 0.58rem; margin-top: 8px; }
.up   { color: var(--green); }
.down { color: var(--red); }
.neu  { color: var(--blue); }

/* â”€â”€ Objetivo progress â”€â”€ */
.objetivo-card {
  background: var(--card); border: 1px solid var(--border);
  padding: 22px 24px; margin-bottom: 32px;
}
.obj-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 14px; }
.obj-title { font-family: 'Unbounded', sans-serif; font-size: 0.85rem; font-weight: 600; }
.obj-meta { font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--muted); }
.obj-bar { height: 8px; background: var(--border2); border-radius: 1px; overflow: hidden; margin-bottom: 8px; }
.obj-fill { height: 100%; border-radius: 1px; transition: width 1.5s ease; }
.obj-labels { display: flex; justify-content: space-between; font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--muted); }

/* â”€â”€ Charts â”€â”€ */
.chart-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.chart-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 32px; }
.chart-card { background: var(--card); border: 1px solid var(--border); padding: 24px; }
.chart-title { font-family: 'Unbounded', sans-serif; font-size: 0.72rem; font-weight: 600; letter-spacing: -0.01em; margin-bottom: 4px; }
.chart-sub { font-family: 'JetBrains Mono', monospace; font-size: 0.58rem; color: var(--muted); margin-bottom: 20px; }
.chart-wrap { width: 100%; }
.chart-wrap canvas { display: block; width: 100% !important; }

/* â”€â”€ Ratio cierre â”€â”€ */
.ratio-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 32px; }
.ratio-card { background: var(--card); border: 1px solid var(--border); padding: 22px 20px; }

/* â”€â”€ Table â”€â”€ */
.table-wrap { background: var(--card); border: 1px solid var(--border); overflow-x: auto; margin-bottom: 32px; }
table { width: 100%; border-collapse: collapse; }
thead { background: rgba(255,255,255,0.02); }
th {
  font-family: 'JetBrains Mono', monospace; font-size: 0.56rem; letter-spacing: 0.15em;
  text-transform: uppercase; color: var(--muted); padding: 12px 16px;
  text-align: right; border-bottom: 1px solid var(--border); white-space: nowrap;
}
th:first-child { text-align: left; }
td {
  font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;
  padding: 11px 16px; text-align: right;
  border-bottom: 1px solid rgba(255,255,255,0.025); white-space: nowrap;
}
td:first-child { font-family: 'Epilogue', sans-serif; font-weight: 500; text-align: left; font-size: 0.78rem; }
tr:last-child td { border-bottom: none; }
tr:hover td { background: rgba(255,255,255,0.012); }

/* â”€â”€ Share modal â”€â”€ */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.7);
  backdrop-filter: blur(4px); z-index: 1000;
  display: flex; align-items: center; justify-content: center;
  display: none;
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--card); border: 1px solid var(--border2);
  padding: 36px; width: 100%; max-width: 480px;
}
.modal h2 { font-family: 'Unbounded', sans-serif; font-size: 1.1rem; font-weight: 600; margin-bottom: 24px; }
.share-option {
  display: flex; align-items: center; gap: 16px;
  padding: 16px; border: 1px solid var(--border);
  margin-bottom: 12px; cursor: pointer; transition: all 0.15s; text-decoration: none; color: var(--text);
}
.share-option:hover { border-color: var(--c); background: rgba(108,99,255,0.05); }
.share-option-icon { font-size: 1.5rem; }
.share-option-label { font-weight: 600; font-size: 0.85rem; }
.share-option-desc { font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--muted); margin-top: 2px; }
.modal-close { background: none; border: 1px solid var(--border2); color: var(--muted); padding: 10px 20px; cursor: pointer; font-family: 'Epilogue', sans-serif; width: 100%; margin-top: 8px; }
.modal-close:hover { border-color: var(--muted); color: var(--text); }

/* â”€â”€ Footer â”€â”€ */
footer {
  position: relative; z-index: 1;
  padding: 20px 40px; border-top: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  font-family: 'JetBrains Mono', monospace; font-size: 0.58rem; color: var(--muted);
  letter-spacing: 0.1em; text-transform: uppercase;
}

/* â”€â”€ Responsive â”€â”€ */
@media (max-width: 1100px) {
  .kpi-grid, .kpi-grid-8 { grid-template-columns: repeat(2, 1fr); }
  .chart-grid-3, .ratio-grid { grid-template-columns: 1fr 1fr; }
}
@media (max-width: 768px) {
  header { padding: 0 16px; }
  main { padding: 20px 16px 48px; }
  footer { padding: 16px; flex-direction: column; gap: 8px; }
  .chart-grid-2, .chart-grid-3, .ratio-grid { grid-template-columns: 1fr; }
  .kpi-grid, .kpi-grid-8 { grid-template-columns: 1fr 1fr; gap: 10px; }
  .header-center-name { display: none; }
}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:14px">
    <div class="logo" id="headerLogo">BZ<span>55</span></div>
    <div style="width:1px;height:28px;background:var(--border2)"></div>
    <div class="header-center-name" id="headerName">â€”</div>
  </div>
  <div class="header-right">
    <div class="update-pill" id="updatePill">Sin datos</div>
    <button class="share-btn" id="shareBtn" onclick="openShare()">ğŸ“¤ Compartir</button>
  </div>
</header>

<!-- No data state -->
<div class="no-data" id="noDataState">
  <div class="no-data-icon">ğŸ“Š</div>
  <h2>Sin datos para este centro</h2>
  <p>
    AÃºn no se han cargado datos para este centro.<br>
    Ve a <a href="procesar.html">procesar.html</a> para subir el Excel del ERP.
  </p>
</div>

<!-- Main dashboard (hidden until data loads) -->
<main id="dashMain" style="display:none">

  <!-- Rescue alert (shown conditionally) -->
  <div class="alert-banner" id="rescueAlert" style="display:none">
    <span class="alert-icon">âš </span>
    <div>
      <div class="alert-text" id="alertText">Programa de rescate activo</div>
      <div class="alert-sub" id="alertSub"></div>
    </div>
  </div>

  <!-- Objetivo progress -->
  <div class="objetivo-card" id="objetivoCard">
    <div class="obj-header">
      <span class="obj-title" id="objTitle">Progreso hacia objetivo</span>
      <span class="obj-meta" id="objMeta"></span>
    </div>
    <div class="obj-bar"><div class="obj-fill" id="objFill"></div></div>
    <div class="obj-labels">
      <span>0</span>
      <span id="objCurrent" style="color:var(--c)"></span>
      <span id="objTarget"></span>
    </div>
  </div>

  <!-- KPIs Ãºltimos mes -->
  <p class="section-label" id="kpiLabel">KPIs Â· Ãšltimo mes</p>
  <div class="kpi-grid" id="kpiGrid1"></div>
  <div class="kpi-grid-8" id="kpiGrid2"></div>

  <!-- Charts -->
  <p class="section-label">EvoluciÃ³n mensual</p>
  <div class="chart-grid-2">
    <div class="chart-card">
      <div class="chart-title">Clientes activos</div>
      <div class="chart-sub">Ãšnicos con servicio vÃ¡lido por mes</div>
      <div class="chart-wrap"><canvas id="chartClientes"></canvas></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">FacturaciÃ³n</div>
      <div class="chart-sub">Total vs Cuotas Â· Sin IVA (â‚¬)</div>
      <div class="chart-wrap"><canvas id="chartFact"></canvas></div>
    </div>
  </div>
  <div class="chart-grid-3">
    <div class="chart-card">
      <div class="chart-title">Ticket medio</div>
      <div class="chart-sub">Fact. cuotas / clientes activos</div>
      <div class="chart-wrap"><canvas id="chartTicket"></canvas></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">Altas vs Bajas</div>
      <div class="chart-sub">Movimiento mensual de clientes</div>
      <div class="chart-wrap"><canvas id="chartAltasBajas"></canvas></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">Balance neto</div>
      <div class="chart-sub">Altas â€“ Bajas por mes</div>
      <div class="chart-wrap"><canvas id="chartBalance"></canvas></div>
    </div>
  </div>

  <!-- Ratio cierre sesiones de prueba -->
  <p class="section-label">Ratio de conversiÃ³n Â· Sesiones de prueba</p>
  <div class="ratio-grid" id="ratioGrid"></div>

  <!-- Tabla histÃ³rica -->
  <p class="section-label">HistÃ³rico mensual completo</p>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Mes</th><th>Clientes</th><th>Fact. Total â‚¬</th><th>Fact. Cuotas â‚¬</th>
          <th>Ticket â‚¬</th><th>Altas</th><th>Bajas</th><th>Balance</th><th>Pruebas</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

</main>

<footer>
  <span>ASESFIT Ã— BZ55 Fitness Concept</span>
  <span id="footerCentro"></span>
</footer>

<!-- Share modal -->
<div class="modal-overlay" id="shareModal">
  <div class="modal">
    <h2>Compartir Dashboard</h2>
    <a class="share-option" id="shareEmail" href="#">
      <span class="share-option-icon">âœ‰ï¸</span>
      <div>
        <div class="share-option-label">Enviar por Email</div>
        <div class="share-option-desc" id="shareEmailDesc">Abre tu cliente de correo</div>
      </div>
    </a>
    <a class="share-option" id="shareWhatsapp" href="#">
      <span class="share-option-icon">ğŸ’¬</span>
      <div>
        <div class="share-option-label">Enviar por WhatsApp</div>
        <div class="share-option-desc" id="shareWaDesc">Abre WhatsApp con el mensaje listo</div>
      </div>
    </a>
    <button class="modal-close" onclick="closeShare()">Cerrar</button>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  LOAD DATA
//  Determines which center this page is for
//  by reading the filename or URL param
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Detect center ID from filename: dashboard_JR.html â†’ JR
function detectCentroId() {
  const filename = window.location.pathname.split('/').pop().replace('.html','');
  // Matches dashboard_JR, dashboard_jr, dashboard_LDH, etc.
  const match = filename.match(/dashboard[_-](.+)/i);
  if (match) {
    const candidate = match[1].toUpperCase();
    const found = BZ55_CONFIG.centros.find(c => c.id === candidate);
    if (found) return found.id;
  }
  // Try URL param ?centro=JR
  const params = new URLSearchParams(window.location.search);
  return params.get('centro')?.toUpperCase() || null;
}

const centroId = detectCentroId();
const centro   = BZ55_CONFIG.centros.find(c => c.id === centroId);

if (!centro) {
  document.getElementById('noDataState').innerHTML = `
    <div class="no-data-icon">âš ï¸</div>
    <h2>Centro no reconocido</h2>
    <p>ID de centro no encontrado en config.js<br>Archivo: ${window.location.pathname}</p>`;
} else {
  // Apply center color
  document.documentElement.style.setProperty('--c', centro.color);
  document.getElementById('headerName').textContent = centro.nombre;
  document.title = `BZ55 Â· ${centro.nombre} Â· Dashboard`;
  document.getElementById('footerCentro').textContent = `${centro.nombre} Â· ${centro.ciudad}`;

  // Load data from localStorage
  const raw = localStorage.getItem(`bz55_datos_${centroId}`);
  if (!raw) {
    document.getElementById('noDataState').style.display = 'flex';
  } else {
    const payload = JSON.parse(raw);
    const updated = new Date(payload.updated_at);
    document.getElementById('updatePill').textContent = `Actualizado ${updated.toLocaleDateString('es-ES')}`;
    document.getElementById('noDataState').style.display = 'none';
    document.getElementById('dashMain').style.display   = 'block';
    initDashboard(payload.meses, centro);
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  INIT DASHBOARD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initDashboard(meses, c) {
  const last = meses[meses.length - 1];
  const prev = meses.length > 1 ? meses[meses.length - 2] : null;

  // Rescue alert
  if (c.estado === 'rescate') {
    const gap = c.objetivo_clientes - last.clientes;
    document.getElementById('rescueAlert').style.display = 'flex';
    document.getElementById('alertText').textContent = `Programa de rescate activo Â· Faltan ${gap} clientes para el objetivo`;
    document.getElementById('alertSub').textContent = `${last.clientes} clientes actuales de ${c.objetivo_clientes} objetivo`;
  }

  // Objetivo progress
  const pct = Math.min(100, Math.round((last.clientes / c.objetivo_clientes) * 100));
  document.getElementById('objFill').style.width  = pct + '%';
  document.getElementById('objFill').style.background = `linear-gradient(90deg, ${c.color}, ${c.color}cc)`;
  document.getElementById('objTitle').textContent = `Progreso hacia objetivo Â· ${c.objetivo_clientes} clientes`;
  document.getElementById('objCurrent').textContent = `Actual: ${last.clientes} (${pct}%)`;
  document.getElementById('objTarget').textContent   = `Meta: ${c.objetivo_clientes}`;

  // Section label
  document.getElementById('kpiLabel').textContent = `KPIs Â· ${last.label}`;

  // KPI row 1
  buildKPI('kpiGrid1', [
    { label: 'Clientes activos', val: last.clientes, color: c.color, delta: delta(last.clientes, prev?.clientes, '', true) },
    { label: 'Fact. Cuotas',     val: fmtEur(last.fact_cuotas), color: 'var(--green)', delta: deltaPct(last.fact_cuotas, prev?.fact_cuotas) },
    { label: 'Fact. Total',      val: fmtEur(last.fact_total),  color: 'var(--blue)',  delta: deltaPct(last.fact_total, prev?.fact_total) },
    { label: 'Ticket Medio',     val: fmtEur(last.ticket, 2),   color: 'var(--gold)',  delta: delta(last.ticket, prev?.ticket, 'â‚¬') },
  ]);

  // KPI row 2
  buildKPI('kpiGrid2', [
    { label: 'Altas',          val: last.altas,  color: 'var(--green)', delta: delta(last.altas, prev?.altas, '', true) },
    { label: 'Bajas',          val: last.bajas,  color: 'var(--red)',   delta: delta(last.bajas, prev?.bajas, '', false, true) },
    { label: 'Balance neto',   val: (last.altas-last.bajas >= 0 ? '+' : '') + (last.altas-last.bajas), color: last.altas-last.bajas >= 0 ? 'var(--green)' : 'var(--red)', delta: '' },
    { label: 'Sesiones prueba',val: last.pruebas, color: 'var(--muted)', delta: delta(last.pruebas, prev?.pruebas, '', true) },
  ]);

  // Charts
  const labels    = meses.map(m => m.label);
  const clientes  = meses.map(m => m.clientes);
  const factTotal = meses.map(m => m.fact_total);
  const factCuotas= meses.map(m => m.fact_cuotas);
  const ticket    = meses.map(m => m.ticket);
  const altas     = meses.map(m => m.altas);
  const bajas     = meses.map(m => m.bajas);
  const balance   = meses.map(m => m.altas - m.bajas);
  const OBJ       = c.objetivo_clientes;

  const chartOpts = { responsive: true, maintainAspectRatio: true, aspectRatio: 2.2, plugins: { legend: { labels: { color: '#5a5a80', font: { family: 'JetBrains Mono', size: 9 }, boxWidth: 10 } }, tooltip: { backgroundColor: '#10101e', borderColor: '#28284a', borderWidth: 1, titleColor: '#5a5a80', bodyColor: '#eeeef5', titleFont: { family: 'JetBrains Mono', size: 9 }, bodyFont: { family: 'JetBrains Mono', size: 10 } } }, scales: { x: { ticks: { color: '#3a3a58', font: { family: 'JetBrains Mono', size: 8 }, maxRotation: 40 }, grid: { color: 'rgba(255,255,255,0.03)' } }, y: { ticks: { color: '#3a3a58', font: { family: 'JetBrains Mono', size: 8 } }, grid: { color: 'rgba(255,255,255,0.03)' } } } };
  const smallOpts = { ...chartOpts, aspectRatio: 2 };

  new Chart(document.getElementById('chartClientes'), {
    type: 'bar',
    data: { labels, datasets: [
      { label: 'Clientes', data: clientes, backgroundColor: clientes.map(v => v >= OBJ ? 'var(--green)' : c.color + '99'), borderRadius: 3 },
      { label: `Objetivo ${OBJ}`, data: Array(labels.length).fill(OBJ), type: 'line', borderColor: 'var(--red)', borderDash: [6,4], borderWidth: 1.5, pointRadius: 0, fill: false },
    ]},
    options: chartOpts,
  });

  new Chart(document.getElementById('chartFact'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Total', data: factTotal, borderColor: 'var(--blue)', backgroundColor: 'rgba(61,184,255,0.08)', tension: 0.3, pointRadius: 3, borderWidth: 2, fill: true },
      { label: 'Cuotas', data: factCuotas, borderColor: c.color, backgroundColor: c.color + '15', tension: 0.3, pointRadius: 3, borderWidth: 2, fill: true },
    ]},
    options: chartOpts,
  });

  new Chart(document.getElementById('chartTicket'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Ticket Medio', data: ticket, borderColor: 'var(--gold)', tension: 0.3, pointRadius: 4, borderWidth: 2 },
    ]},
    options: smallOpts,
  });

  new Chart(document.getElementById('chartAltasBajas'), {
    type: 'bar',
    data: { labels, datasets: [
      { label: 'Altas', data: altas, backgroundColor: 'rgba(0,232,162,0.7)', borderRadius: 2 },
      { label: 'Bajas', data: bajas, backgroundColor: 'rgba(255,79,110,0.7)', borderRadius: 2 },
    ]},
    options: smallOpts,
  });

  new Chart(document.getElementById('chartBalance'), {
    type: 'bar',
    data: { labels, datasets: [{
      label: 'Balance', data: balance,
      backgroundColor: balance.map(v => v >= 0 ? 'rgba(0,232,162,0.7)' : 'rgba(255,79,110,0.7)'),
      borderRadius: 2,
    }]},
    options: smallOpts,
  });

  // Ratio cierre
  buildRatioCierre(meses);

  // Table
  buildTable(meses);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  RATIO CIERRE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildRatioCierre(meses) {
  const grid = document.getElementById('ratioGrid');
  const totalPruebas = meses.reduce((s, m) => s + m.pruebas, 0);
  const totalAltas   = meses.reduce((s, m) => s + m.altas,   0);
  const last6 = meses.slice(-6);
  const pruebas6 = last6.reduce((s, m) => s + m.pruebas, 0);
  const last = meses[meses.length - 1];

  grid.innerHTML = `
    <div class="ratio-card">
      <div class="kpi-label">Sesiones de prueba (total)</div>
      <div class="kpi-val" style="color:var(--gold)">${totalPruebas}</div>
      <div class="kpi-delta neu">HistÃ³rico acumulado</div>
    </div>
    <div class="ratio-card">
      <div class="kpi-label">Pruebas Ãºltimos 6 meses</div>
      <div class="kpi-val" style="color:var(--gold)">${pruebas6}</div>
      <div class="kpi-delta neu">Tendencia reciente</div>
    </div>
    <div class="ratio-card">
      <div class="kpi-label">Pruebas Ãºltimo mes (${last.label})</div>
      <div class="kpi-val" style="color:var(--gold)">${last.pruebas}</div>
      <div class="kpi-delta neu">+ ${last.altas} altas ese mes</div>
    </div>
  `;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  TABLE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildTable(meses) {
  const tb = document.getElementById('tableBody');
  [...meses].reverse().forEach(m => {
    const b = m.altas - m.bajas;
    const bc = b > 0 ? 'up' : b < 0 ? 'down' : '';
    tb.innerHTML += `<tr>
      <td>${m.label}</td>
      <td class="neu">${m.clientes}</td>
      <td>${fmtN(m.fact_total)}â‚¬</td>
      <td>${fmtN(m.fact_cuotas)}â‚¬</td>
      <td>${m.ticket.toFixed(2)}â‚¬</td>
      <td class="up">${m.altas || 'â€”'}</td>
      <td class="down">${m.bajas || 'â€”'}</td>
      <td class="${bc}">${b > 0 ? '+' : ''}${b}</td>
      <td class="neu">${m.pruebas}</td>
    </tr>`;
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildKPI(containerId, items) {
  const g = document.getElementById(containerId);
  g.innerHTML = items.map(i => `
    <div class="kpi-card" style="--kpi-c:${i.color}">
      <div class="kpi-label">${i.label}</div>
      <div class="kpi-val" style="color:${i.color}">${i.val}</div>
      <div class="kpi-delta">${i.delta}</div>
    </div>`).join('');
}

function fmtN(n)      { return n?.toLocaleString('es-ES', { minimumFractionDigits: 0, maximumFractionDigits: 0 }) ?? 'â€”'; }
function fmtEur(n, d=0) {
  if (n == null) return 'â€”';
  const s = n.toLocaleString('es-ES', { minimumFractionDigits: d, maximumFractionDigits: d });
  return `${s}<span class="u">â‚¬</span>`;
}

function delta(cur, prev, suffix='', higherIsBetter=true, lowerIsBetter=false) {
  if (prev == null) return '';
  const diff = cur - prev;
  const isGood = lowerIsBetter ? diff < 0 : higherIsBetter ? diff > 0 : null;
  const cls = isGood === true ? 'up' : isGood === false ? 'down' : 'neu';
  const sign = diff > 0 ? 'â–² +' : diff < 0 ? 'â–¼ ' : '= ';
  return `<span class="${cls}">${sign}${Math.abs(diff).toLocaleString('es-ES')}${suffix} vs ant.</span>`;
}

function deltaPct(cur, prev) {
  if (!prev || prev === 0) return '';
  const pct = ((cur - prev) / prev * 100).toFixed(1);
  const cls = cur >= prev ? 'up' : 'down';
  const sign = cur >= prev ? 'â–² +' : 'â–¼ ';
  return `<span class="${cls}">${sign}${pct}% vs ant.</span>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  SHARE MODAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openShare() {
  if (!centro) return;
  const url  = window.location.href;
  const body = encodeURIComponent(`Hola,\n\nAdjunto el enlace al dashboard actualizado del centro ${centro.nombre}:\n${url}\n\nUn saludo`);
  const subj = encodeURIComponent(`BZ55 ${centro.nombre} Â· Dashboard ${new Date().toLocaleDateString('es-ES', { month: 'long', year: 'numeric' })}`);

  document.getElementById('shareEmail').href = `mailto:${centro.destinatarios?.email || ''}?subject=${subj}&body=${body}`;
  document.getElementById('shareEmailDesc').textContent = centro.destinatarios?.email || 'Configura el email en config.js';
  document.getElementById('shareWhatsapp').href = `https://wa.me/${(centro.destinatarios?.whatsapp || '').replace(/\D/g,'')}?text=${encodeURIComponent(`Hola, te comparto el dashboard actualizado de ${centro.nombre}: ${url}`)}`;
  document.getElementById('shareWaDesc').textContent = centro.destinatarios?.whatsapp || 'Configura el WhatsApp en config.js';

  document.getElementById('shareModal').classList.add('open');
}
function closeShare() { document.getElementById('shareModal').classList.remove('open'); }
document.getElementById('shareModal').addEventListener('click', e => { if (e.target === e.currentTarget) closeShare(); });
</script>
</body>
</html>
